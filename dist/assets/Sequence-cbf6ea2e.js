import{f as a,B as r,g as c,i as o,h as u,j as l,k as d,P as h,a8 as m,S as f,a as p,l as S,T as g,m as v,b as q,a9 as _,n as y,bt as b}from"./index-d0b155bb.js";import{e as C,E as w,a as x,b as k,c as T}from"./EntityTaskList-3820433e.js";import{E}from"./EditSequenceModal-8c3e7aa7.js";import"./PeopleNameCell-f77b3a1d.js";const L={name:"sequence",mixins:[C,a],components:{ButtonSimple:r,ComboboxNumber:c,ComboboxStyled:o,CornerLeftUpIcon:u,DescriptionCell:l,EditSequenceModal:E,EntityNews:w,EntityPreviewFiles:x,EntityTaskList:k,EntityTimeLogs:T,EntityThumbnail:d,PageSubtitle:h,PageTitle:m,Schedule:f,TableInfo:p,TaskInfo:S,TaskTypeName:g},data(){return{type:"sequence",currentSequence:null,currentTask:null,casting:{isLoading:!1,isError:!1},errors:{edit:!1},loading:{edit:!1},modals:{edit:!1,preview:!1}}},mounted(){this.clearSelectedTasks(),this.loadCurrentSequence().then(n=>{this.currentSequence=n,this.currentSection=this.route.query.section||"casting",this.casting.isLoading=!0,this.casting.isError=!1,this.currentSequence?this.loadSequenceCasting(this.currentSequence).then(()=>{this.casting.isLoading=!1}).catch(e=>{this.casting.isLoading=!1,this.casting.isError=!0,console.error(e)}):this.resetData()}).catch(console.error)},computed:{...v(["currentEpisode","currentProduction","getTaskTypePriority","sequenceMap","sequenceMetadataDescriptors","sequenceSearchText","isCurrentUserManager","route","taskMap","taskTypeMap"]),title(){return this.currentSequence?this.currentEpisode?`${this.currentEpisode.name} / ${this.currentSequence.name}`:`${this.currentSequence.name}`:"Loading..."},currentEntity(){return this.currentSequence},getSequencesRoute(){const n=this.currentProduction.id,e=this.currentEpisode?this.currentEpisode.id:null,t=b(n,"sequences",e);return t.query={search:this.sequenceSearchText},t},nbAssets(){let n=0;return this.currentSequence&&this.currentSection==="casting"&&this.currentSequence.castingAssetsByType&&this.currentSequence.castingAssetsByType.forEach(e=>{n+=e.length}),n}},methods:{...q(["clearSelectedTasks","editSequence","setCurrentSequence","loadEpisodes","loadSequencesWithTasks","loadSequenceCasting"]),loadCurrentSequence(){return new Promise((n,e)=>{const t=this.route.params.sequence_id,s=this.sequenceMap.get(t)||null;return!s||!s.validations?this.loadEpisodes().then(()=>this.loadSequencesWithTasks()).then(()=>{const i=this.sequenceMap.get(t)||null;return n(i)}):n(s)})},confirmEditSequence(n){n.id=this.currentSequence.id,this.loading.edit=!0,this.errors.edit=!1,this.editSequence(n).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(e=>{console.error(e),this.loading.edit=!1,this.errors.edit=!0})},buildAssetRoute(n){let e=n.sequence_id;e||(e="main");const t={name:"asset",params:{production_id:this.currentProduction.id,asset_id:n.asset_id}};return _(t,e)},resetData(){this.casting.isLoading=!0,this.$nextTick(()=>{this.loadCurrentSequence().then(n=>(this.currentSequence=n,this.loadSequenceCasting(this.currentSequence))).then(()=>{this.casting.isLoading=!1}).catch(n=>{this.casting.isError=!0,this.casting.isLoading=!1,console.error(n)})})}},watch:{},metaInfo(){return{title:`${this.title} - Kitsu`}}};var $=function(){var e=this,t=e._self._c;return t("div",{staticClass:"columns fixed-page sequence xyz-in",attrs:{xyz:"fade"}},[t("div",{staticClass:"column main-column"},[t("div",{staticClass:"page-header flexrow"},[t("router-link",{staticClass:"flexrow-item has-text-centered back-link",attrs:{to:e.getSequencesRoute}},[t("corner-left-up-icon")],1),t("span",{staticClass:"flexrow-item ml2"},[e.currentSequence?t("entity-thumbnail",{staticClass:"entity-thumbnail",attrs:{entity:e.currentSequence,"empty-width":120,"empty-height":50,width:120}}):e._e()],1),t("div",{staticClass:"flexrow-item"},[t("page-title",{staticClass:"entity-title",attrs:{text:e.title}})],1)],1),t("div",{staticClass:"flexrow infos"},[t("div",{staticClass:"flexrow-item block flexcolumn"},[t("page-subtitle",{attrs:{text:e.$t("sequences.tasks")}}),t("entity-task-list",{staticClass:"task-list",attrs:{entries:e.currentTasks.map(s=>s.id),"is-loading":!e.currentSequence,"is-error":!1},on:{"task-selected":e.onTaskSelected}})],1),t("div",{staticClass:"flexrow-item block flexcolumn"},[t("div",{staticClass:"flexrow"},[t("page-subtitle",{attrs:{text:e.$t("main.info")}}),t("div",{staticClass:"filler"}),t("div",{staticClass:"flexrow-item has-text-right"},[e.isCurrentUserManager?t("button-simple",{attrs:{icon:"edit"},on:{click:function(s){e.modals.edit=!0}}}):e._e()],1)],1),t("div",{staticClass:"table-body"},[e.currentSequence?t("table",{staticClass:"datatable no-header"},[t("tbody",{staticClass:"datatable-body"},[t("tr",{staticClass:"datatable-row"},[t("td",{staticClass:"field-label"},[e._v(e._s(e.$t("shots.fields.description")))]),t("description-cell",{attrs:{entry:e.currentSequence,full:!0}})],1),e._l(e.sequenceMetadataDescriptors,function(s){return t("tr",{key:s.id,staticClass:"datatable-row"},[t("td",{staticClass:"field-label"},[e._v(e._s(s.name))]),t("td",[e._v(" "+e._s(e.currentSequence&&e.currentSequence.data?e.currentSequence.data[s.field_name]:"")+" ")])])})],2)]):e._e()])])]),t("div",{staticClass:"sequence-data block"},[t("div",{staticClass:"flexrow"},[t("combobox-styled",{staticClass:"section-combo flexrow-item",attrs:{options:e.entityNavOptions},model:{value:e.currentSection,callback:function(s){e.currentSection=s},expression:"currentSection"}}),t("span",{directives:[{name:"show",rawName:"v-show",value:e.currentSection==="casting",expression:"currentSection === 'casting'"}]},[e._v(" "+e._s(e.nbAssets)+" "+e._s(e.$tc("assets.number",e.nbAssets))+" ")]),t("span",{directives:[{name:"show",rawName:"v-show",value:e.currentSection==="casting"&&e.currentSequence&&e.currentSequence.is_casting_standby,expression:"currentSection === 'casting' && currentSequence && currentSequence.is_casting_standby"}],staticClass:"tag tag-standby"},[e._v(" "+e._s(e.$t("breakdown.fields.standby"))+" ")]),t("div",{staticClass:"filler"}),t("span",{directives:[{name:"show",rawName:"v-show",value:e.currentSection==="schedule",expression:"currentSection === 'schedule'"}],staticClass:"flexrow-item mt05"},[e._v(" "+e._s(e.$t("schedule.zoom_level"))+": ")]),t("combobox-number",{directives:[{name:"show",rawName:"v-show",value:e.currentSection==="schedule",expression:"currentSection === 'schedule'"}],staticClass:"zoom-level flexrow-item",attrs:{options:e.zoomOptions,"is-simple":""},model:{value:e.zoomLevel,callback:function(s){e.zoomLevel=s},expression:"zoomLevel"}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.currentSection==="casting",expression:"currentSection === 'casting'"}],staticClass:"sequence-casting"},[e.currentSequence?t("div",[e.currentSequence&&e.currentSequence.castingAssetsByType&&e.currentSequence.castingAssetsByType[0].length>0?t("div",e._l(e.currentSequence.castingAssetsByType,function(s){return t("div",{key:s.length>0?s[0].asset_type_name:"",staticClass:"type-assets"},[t("div",{staticClass:"asset-type"},[e._v(" "+e._s(s.length>0?s[0].asset_type_name:"")+" ("+e._s(s.length)+") ")]),t("div",{staticClass:"asset-list"},e._l(s,function(i){return t("router-link",{key:i.id,staticClass:"asset-link",attrs:{to:e.buildAssetRoute(i)}},[t("entity-thumbnail",{staticClass:"entity-thumbnail",attrs:{entity:i,square:!0,"empty-width":103,"empty-height":103,"with-link":!1,"no-cache":!0}}),t("div",[e._v(" "+e._s(i.asset_name)+" "),i.nb_occurences>1?t("span",[e._v(" ("+e._s(i.nb_occurences)+") ")]):e._e()]),t("div",{staticClass:"ready-for flexrow"},[i.ready_for?t("task-type-name",{staticClass:"flexrow-item",attrs:{"task-type":e.taskTypeMap.get(i.ready_for),"current-production-id":e.currentProduction.id,title:"Ready for: "+e.taskTypeMap.get(i.ready_for).name}}):e._e()],1)],1)}),1)])}),0):t("div",{staticClass:"mt1"},[e._v(" "+e._s(e.$t("sequences.no_casting"))+" ")])]):t("table-info",{attrs:{"is-loading":e.casting.isLoading,"is-error":e.casting.isError}})],1),e.scheduleItems[0].children.length>0?t("div",{directives:[{name:"show",rawName:"v-show",value:e.currentSection==="schedule",expression:"currentSection === 'schedule'"}],staticClass:"schedule mt1"},[t("div",{staticClass:"wrapper"},[t("schedule",{ref:"schedule-widget",attrs:{"start-date":e.tasksStartDate,"end-date":e.tasksEndDate,hierarchy:e.scheduleItems,"zoom-level":e.zoomLevel,"is-loading":!1,"is-estimation-linked":!0,"hide-root":!0,"with-milestones":!1}})],1)]):t("div",{directives:[{name:"show",rawName:"v-show",value:e.currentSection==="schedule",expression:"currentSection === 'schedule'"}],staticClass:"mt1"},[e._v(" "+e._s(e.$t("main.empty_schedule"))+" ")]),e.currentSequence&&e.currentSection==="preview-files"?t("entity-preview-files",{attrs:{entity:e.currentSequence}}):e._e(),e.currentSequence&&e.currentSection==="activity"?t("entity-news",{attrs:{entity:e.currentSequence}}):e._e(),e.currentSequence&&e.currentSection==="time-logs"?t("entity-time-logs",{attrs:{entity:e.currentSequence}}):e._e()],1)]),e.currentTask?t("div",{staticClass:"column side-column"},[t("task-info",{attrs:{task:e.currentTask}})],1):e._e(),t("edit-sequence-modal",{ref:"edit-sequence-modal",attrs:{active:e.modals.edit,"is-loading":e.loading.edit,"is-error":e.errors.edit,"sequence-to-edit":e.currentSequence},on:{cancel:function(s){e.modals.edit=!1},confirm:e.confirmEditSequence}})],1)},M=[],z=y(L,$,M,!1,null,"1ab72f85",null,null);const B=z.exports;export{B as default};
//# sourceMappingURL=Sequence-cbf6ea2e.js.map
