import{$ as l,B as d,C as c,J as p,as as u,l as h,at as k,au as m,av as _,aw as f,m as y,ax as T,ak as b,ay as n,b as v,az as C,e as r,n as x}from"./index-d0b155bb.js";import{C as S}from"./ComboboxProduction-4b5befd8.js";const g={name:"todos",components:{ActionPanel:l,ButtonSimple:d,Combobox:c,ComboboxProduction:S,ComboboxTaskType:p,PeopleField:u,TaskInfo:h,TimesheetList:k,TodosList:m,ViewPlaylistModal:_},data(){return{currentFilter:"all_tasks",currentSort:"priority",episodeId:"",isLoading:!1,isLoadingError:!1,isPlaylist:!1,filterOptions:["all_tasks","due_this_week"].map(t=>({label:t,value:t})),person:{},productionId:"",productionList:[],selectionGrid:{},sortOptions:["entity_name","priority","due_date","estimation","last_comment_date"].map(t=>({label:t,value:t})),taskTypeId:"",taskTypeList:[],tasksToCheck:[]}},mounted(){this.isLoading=!0,this.loadTasksToCheck().then(t=>{t&&(t.forEach(f),this.buildSelectionGrid(t),this.resetProductionList(t),this.resetTaskTypeList(t),this.tasksToCheck=t,this.isLoading=!1)}).catch(t=>{console.error(t)})},afterDestroy(){},computed:{...y(["nbSelectedTasks","personMap","productionMap","taskStatusMap","taskTypeMap","selectedTasks"]),nbTasksToCheck(){return this.sortedTasks.filter(t=>this.taskStatusMap.get(t.task_status_id).is_feedback_request).length},assignees(){const t=[],e={};return this.tasksToCheck.forEach(i=>{i.assignees.forEach(s=>{e[s]||(t.push(this.personMap.get(s)),e[s]=!0)})}),t},episodeOptions(){const t=[],e={};return this.productionId?this.productionMap.get(this.productionId).production_type!=="tvshow"?[]:(console.log(this.tasksToCheck),this.tasksToCheck.filter(s=>s.project_id===this.productionId).forEach(s=>{console.log(s),s.episode_id&&!e[s.episode_id]&&s.entity_type_name==="Shot"&&(e[s.episode_id]=!0,t.push({label:s.episode_name,value:s.episode_id}))}),[{label:this.$t("main.all"),value:"all"}].concat(t.sort((s,o)=>s.label.localeCompare(o.label)))):[]},filteredTasks(){let t=this.currentFilter==="all_tasks"?[...this.tasksToCheck]:this.tasksToCheck.filter(e=>{const i=T(e.due_date);return b().startOf("week").isSame(i,"week")});return this.productionId!==""&&(t=t.filter(e=>e.project_id===this.productionId)),this.taskTypeId!==""&&(t=t.filter(e=>e.task_type_id===this.taskTypeId)),this.person&&this.person.id&&(t=t.filter(e=>e.assignees.includes(this.person.id))),this.productionId&&this.episodeId&&this.episodeId!=="all"&&(t=t.filter(e=>e.episode_id===this.episodeId)),t},sortedTasks(){const t=this.currentSort==="entity_name",e=this.currentSort==="priority",i=this.currentSort==="due_date";let s=this.filteredTasks;return t?s.sort(n("project_name").thenBy("task_type_name").thenBy("full_entity_name")):e?s.sort(n("priority",-1).thenBy((o,a)=>o.due_date?a.due_date?o.due_date.localeCompare(a.due_date):-1:1).thenBy("project_name").thenBy("task_type_name").thenBy("entity_name")):i?s.sort(n((o,a)=>o.due_date?a.due_date?o.due_date.localeCompare(a.due_date):-1:1).thenBy("project_name").thenBy("task_type_name").thenBy("entity_name")):s.sort(n(this.currentSort,-1).thenBy("project_name").thenBy("task_type_name").thenBy("entity_name"))}},methods:{...v(["loadTasksToCheck","removeTodoSearch","saveTodoSearch","setTodosSearch"]),buildSelectionGrid(t){this.selectionGrid=C(t.length,1)},resetProductionList(t=[]){const e={},i=[];t.forEach(s=>{e[s.project_id]||(e[s.project_id]=!0,i.push(this.productionMap.get(s.project_id)))}),this.productionList=[{id:"",name:this.$t("main.all")}].concat(r(i))},resetTaskTypeList(t){const e={},i=[];t.forEach(s=>{e[s.task_type_id]||(e[s.task_type_id]=!0,i.push(this.taskTypeMap.get(s.task_type_id)))}),this.taskTypeList=[{id:"",color:"#999",name:this.$t("news.all")}].concat(r(i))},onTaskSelectionCleared(){this.buildSelectionGrid(this.sortedTasks)},onTaskSelectionAdded(t){this.selectionGrid[t.x][t.y]=!0},onTaskSelectionRemoved(t){this.selectionGrid[t.x][t.y]=!1}},socket:{events:{"task:assign"(t){},"task:unassign"(t){}}},watch:{productionId(){this.episodeId=""},nbSelectedTasks(){this.nbSelectedTasks===0&&this.buildSelectionGrid(this.sortedTasks)}},metaInfo(){return{title:`${this.$t("tasks.my_checks")} - Kitsu`}}};var I=function(){var e=this,i=e._self._c;return i("div",{staticClass:"columns fixed-page"},[i("div",{staticClass:"column main-column"},[i("div",{staticClass:"todos page"},[i("div",{staticClass:"flexrow"},[e.productionList.length>0?i("combobox-production",{staticClass:"flexrow-item",attrs:{label:e.$t("main.production"),"production-list":e.productionList},model:{value:e.productionId,callback:function(s){e.productionId=s},expression:"productionId"}}):e._e(),i("combobox",{directives:[{name:"show",rawName:"v-show",value:e.productionId,expression:"productionId"}],staticClass:"flexrow-item",attrs:{label:e.$t("main.episode"),options:e.episodeOptions},model:{value:e.episodeId,callback:function(s){e.episodeId=s},expression:"episodeId"}}),e.taskTypeList.length>0?i("combobox-task-type",{staticClass:"flexrow-item selector",attrs:{label:e.$t("news.task_type"),"task-type-list":e.taskTypeList},model:{value:e.taskTypeId,callback:function(s){e.taskTypeId=s},expression:"taskTypeId"}}):e._e(),i("div",{staticClass:"field flexrow-item selector small"},[i("label",{staticClass:"label person-label"},[e._v(" "+e._s(e.$t("main.person"))+" ")]),i("people-field",{attrs:{people:e.assignees,big:!0},model:{value:e.person,callback:function(s){e.person=s},expression:"person"}})],1),i("combobox",{staticClass:"flexrow-item",attrs:{label:e.$t("main.show"),options:e.filterOptions,"locale-key-prefix":"tasks."},model:{value:e.currentFilter,callback:function(s){e.currentFilter=s},expression:"currentFilter"}}),i("combobox",{staticClass:"flexrow-item",attrs:{label:e.$t("main.sorted_by"),options:e.sortOptions,"locale-key-prefix":"tasks.fields."},model:{value:e.currentSort,callback:function(s){e.currentSort=s},expression:"currentSort"}})],1),i("div",{staticClass:"flexrow"},[i("h1",{staticClass:"title mt1 flerow-item"},[e._v(" "+e._s(e.nbTasksToCheck)+" tasks to check ")]),i("div",{staticClass:"filler"}),i("ButtonSimple",{staticClass:"flexrow-item",attrs:{text:"Build playlist from list"},on:{click:function(s){e.isPlaylist=!0}}})],1),i("todos-list",{attrs:{tasks:e.sortedTasks,"is-loading":e.isLoading,"is-error":e.isLoadingError,"selection-grid":e.selectionGrid,"is-to-check":!0},on:{"task-selection-cleared":e.onTaskSelectionCleared,"task-selection-addition":e.onTaskSelectionAdded,"task-selection-removal":e.onTaskSelectionRemoved}})],1)]),e.nbSelectedTasks===1?i("div",{staticClass:"column side-column"},[i("task-info",{attrs:{task:e.selectedTasks.values().next().value}})],1):e._e(),i("view-playlist-modal",{attrs:{active:e.isPlaylist,"task-ids":e.sortedTasks.map(s=>s.id)},on:{cancel:function(s){e.isPlaylist=!1}}})],1)},w=[],L=x(g,I,w,!1,null,"41a5ac26",null,null);const $=L.exports;export{$ as default};
//# sourceMappingURL=MyChecks-fe9861b7.js.map
