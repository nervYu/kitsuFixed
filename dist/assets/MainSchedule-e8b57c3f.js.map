{"version":3,"file":"MainSchedule-e8b57c3f.js","sources":["../../src/components/pages/MainSchedule.vue"],"sourcesContent":["<template>\n<div\n  class=\"columns fixed-page\"\n>\n  <div\n    class=\"column main-column\"\n  >\n    <div class=\"flexrow project-dates\">\n      <div class=\"flexrow-item\">\n        <label class=\"label\">\n          {{ $t('main.start_date') }}\n        </label>\n        <datepicker\n          wrapper-class=\"datepicker\"\n          input-class=\"date-input input\"\n          :language=\"locale\"\n          :disabled-dates=\"{ days: [6, 0] }\"\n          :monday-first=\"true\"\n          format=\"yyyy-MM-dd\"\n          v-model=\"selectedStartDate\"\n          disabled\n        />\n      </div>\n      <div class=\"flexrow-item field\">\n        <label class=\"label\">\n          {{ $t('main.end_date') }}\n        </label>\n        <datepicker\n          wrapper-class=\"datepicker\"\n          input-class=\"date-input input\"\n          :language=\"locale\"\n          :disabled-dates=\"{ days: [6, 0] }\"\n          :monday-first=\"true\"\n          format=\"yyyy-MM-dd\"\n          v-model=\"selectedEndDate\"\n          disabled\n        />\n      </div>\n      <combobox-number\n        class=\"flexrow-item zoom-level\"\n        :label=\"$t('schedule.zoom_level')\"\n        :options=\"zoomOptions\"\n        v-model=\"zoomLevel\"\n      />\n    </div>\n\n    <schedule\n      :end-date=\"endDate\"\n      :hierarchy=\"scheduleItems\"\n      :is-loading=\"loading.schedule\"\n      :is-error=\"errors.schedule\"\n      :start-date=\"startDate\"\n      :zoom-level=\"zoomLevel\"\n      :hide-man-days=\"true\"\n      @item-changed=\"onScheduleItemChanged\"\n      @change-zoom=\"changeZoom\"\n      @root-element-expanded=\"expandProductionElement\"\n    />\n  </div>\n</div>\n</template>\n\n<script>\n/*\n * Page to manage the schedule of the big steps of the production. It allows\n * to set milestones too.\n */\nimport { mapGetters, mapActions } from 'vuex'\nimport moment from 'moment-timezone'\nimport { en, fr } from 'vuejs-datepicker/dist/locale'\nimport Datepicker from 'vuejs-datepicker'\nimport { getProductionSchedulePath } from '@/lib/path'\n\nimport {\n  getFirstStartDate,\n  getLastEndDate,\n  getStartDateFromString,\n  getEndDateFromString\n} from '@/lib/time'\nimport colors from '@/lib/colors'\n\nimport ComboboxNumber from '@/components/widgets/ComboboxNumber'\nimport Schedule from '@/components/pages/schedule/Schedule'\n\nexport default {\n  name: 'production-schedule',\n  components: {\n    ComboboxNumber,\n    Datepicker,\n    Schedule\n  },\n\n  data () {\n    return {\n      endDate: moment().add(6, 'months'),\n      scheduleItems: [],\n      startDate: moment(),\n      selectedStartDate: null,\n      selectedEndDate: null,\n      zoomLevel: 0,\n      zoomOptions: [\n        { label: 'Week', value: 0 },\n        { label: '1', value: 1 },\n        { label: '2', value: 2 },\n        { label: '3', value: 3 }\n      ],\n      loading: {\n        schedule: false\n      },\n      errors: {\n        schedule: false\n      }\n    }\n  },\n\n  mounted () {\n    this.reset()\n  },\n\n  computed: {\n    ...mapGetters([\n      'openProductions',\n      'taskTypeMap',\n      'user'\n    ]),\n\n    locale () {\n      if (this.user.locale === 'fr_FR') {\n        return fr\n      } else {\n        return en\n      }\n    }\n  },\n\n  methods: {\n    ...mapActions([\n      'editProduction',\n      'loadScheduleItems',\n      'saveScheduleItem'\n    ]),\n\n    changeZoom (event) {\n      if (event.wheelDelta < 0 && this.zoomLevel > 1) this.zoomLevel--\n      if (event.wheelDelta > 0 && this.zoomLevel < 3) this.zoomLevel++\n    },\n\n    reset () {\n      this.scheduleItems = this.convertScheduleItems(this.openProductions)\n      this.startDate = getFirstStartDate(this.scheduleItems)\n      this.endDate = getLastEndDate(this.scheduleItems)\n      this.selectedStartDate = this.startDate.toDate()\n      this.selectedEndDate = this.endDate.toDate()\n    },\n\n    convertScheduleItems (scheduleItems) {\n      return scheduleItems.map((item) => {\n        const startDate = getStartDateFromString(item.start_date)\n        const endDate = getEndDateFromString(startDate, item.end_date)\n        return {\n          ...item,\n          avatar: item.type === 'Project',\n          color: item.color || colors.fromString(item.name, true),\n          startDate: startDate,\n          endDate: endDate,\n          expanded: false,\n          loading: false,\n          editable: true,\n          route: getProductionSchedulePath(item.id),\n          children: []\n        }\n      })\n    },\n\n    convertTaskTypeScheduleItems (scheduleItems) {\n      return scheduleItems.map((item) => {\n        const startDate = getStartDateFromString(item.start_date)\n        const endDate = getEndDateFromString(startDate, item.end_date)\n        const taskType = this.taskTypeMap.get(item.task_type_id)\n\n        return {\n          ...item,\n          name: taskType.name,\n          color: taskType.color,\n          startDate: startDate,\n          endDate: endDate,\n          expanded: false,\n          loading: false,\n          editable: true,\n          children: []\n        }\n      })\n    },\n\n    expandProductionElement (productionElement) {\n      if (!productionElement.expanded) {\n        productionElement.loading = true\n        productionElement.expanded = true\n        this.loadScheduleItems(productionElement)\n          .then((scheduleItems) => {\n            scheduleItems = this.convertTaskTypeScheduleItems(scheduleItems)\n            productionElement.children = scheduleItems\n            productionElement.loading = false\n          })\n      } else {\n        productionElement.expanded = false\n      }\n    },\n\n    onScheduleItemChanged (item) {\n      if (item.type !== 'Project') {\n        this.saveScheduleItem(item)\n      } else {\n        this.editProduction({\n          id: item.id,\n          start_date: item.startDate.format('YYYY-MM-DD'),\n          end_date: item.endDate.format('YYYY-MM-DD')\n        })\n      }\n    }\n  },\n\n  socket: {\n  },\n\n  watch: {\n  },\n\n  metaInfo () {\n    return {\n      title: `${this.$t('schedule.title_main')} - Kitsu`\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.dark {\n  .project-dates {\n    color: $white-grey;\n    border-bottom: 1px solid $grey;\n  }\n}\n\n.project-dates {\n  border-bottom: 1px solid #EEE;\n  padding-bottom: 1em;\n\n  .field {\n    padding-bottom: 0;\n    margin-bottom: 0;\n  }\n\n  .overall-man-days {\n    width: 120px;\n    font-size: 0.9em;\n    margin-right: 1em;\n  }\n}\n\n.fixed-page {\n  padding: 1em;\n  padding-top: 90px;\n  padding-left: 2em;\n}\n\n.main-column {\n  display: flex;\n  border: 0;\n  overflow: hidden;\n  flex-direction: column;\n}\n\n.zoom-level {\n  margin-top: -10px;\n}\n</style>\n"],"names":["_sfc_main","ComboboxNumber","Datepicker","Schedule","moment","mapGetters","fr","en","mapActions","event","getFirstStartDate","getLastEndDate","scheduleItems","item","startDate","getStartDateFromString","endDate","getEndDateFromString","colors","getProductionSchedulePath","taskType","productionElement"],"mappings":"4IAoFA,MAAAA,EAAA,CACA,KAAA,sBACA,WAAA,CACA,eAAAC,EACA,WAAAC,EACA,SAAAC,CACA,EAEA,MAAA,CACA,MAAA,CACA,QAAAC,EAAA,EAAA,IAAA,EAAA,QAAA,EACA,cAAA,CAAA,EACA,UAAAA,EAAA,EACA,kBAAA,KACA,gBAAA,KACA,UAAA,EACA,YAAA,CACA,CAAA,MAAA,OAAA,MAAA,CAAA,EACA,CAAA,MAAA,IAAA,MAAA,CAAA,EACA,CAAA,MAAA,IAAA,MAAA,CAAA,EACA,CAAA,MAAA,IAAA,MAAA,CAAA,CACA,EACA,QAAA,CACA,SAAA,EACA,EACA,OAAA,CACA,SAAA,EACA,CACA,CACA,EAEA,SAAA,CACA,KAAA,MAAA,CACA,EAEA,SAAA,CACA,GAAAC,EAAA,CACA,kBACA,cACA,MACA,CAAA,EAEA,QAAA,CACA,OAAA,KAAA,KAAA,SAAA,QACAC,EAAA,GAEAC,EAAA,EAEA,CACA,EAEA,QAAA,CACA,GAAAC,EAAA,CACA,iBACA,oBACA,kBACA,CAAA,EAEA,WAAAC,EAAA,CACAA,EAAA,WAAA,GAAA,KAAA,UAAA,GAAA,KAAA,YACAA,EAAA,WAAA,GAAA,KAAA,UAAA,GAAA,KAAA,WACA,EAEA,OAAA,CACA,KAAA,cAAA,KAAA,qBAAA,KAAA,eAAA,EACA,KAAA,UAAAC,EAAA,KAAA,aAAA,EACA,KAAA,QAAAC,EAAA,KAAA,aAAA,EACA,KAAA,kBAAA,KAAA,UAAA,OAAA,EACA,KAAA,gBAAA,KAAA,QAAA,OAAA,CACA,EAEA,qBAAAC,EAAA,CACA,OAAAA,EAAA,IAAAC,GAAA,CACA,MAAAC,EAAAC,EAAAF,EAAA,UAAA,EACAG,EAAAC,EAAAH,EAAAD,EAAA,QAAA,EACA,MAAA,CACA,GAAAA,EACA,OAAAA,EAAA,OAAA,UACA,MAAAA,EAAA,OAAAK,EAAA,WAAAL,EAAA,KAAA,EAAA,EACA,UAAAC,EACA,QAAAE,EACA,SAAA,GACA,QAAA,GACA,SAAA,GACA,MAAAG,EAAAN,EAAA,EAAA,EACA,SAAA,CAAA,CACA,CACA,CAAA,CACA,EAEA,6BAAAD,EAAA,CACA,OAAAA,EAAA,IAAAC,GAAA,CACA,MAAAC,EAAAC,EAAAF,EAAA,UAAA,EACAG,EAAAC,EAAAH,EAAAD,EAAA,QAAA,EACAO,EAAA,KAAA,YAAA,IAAAP,EAAA,YAAA,EAEA,MAAA,CACA,GAAAA,EACA,KAAAO,EAAA,KACA,MAAAA,EAAA,MACA,UAAAN,EACA,QAAAE,EACA,SAAA,GACA,QAAA,GACA,SAAA,GACA,SAAA,CAAA,CACA,CACA,CAAA,CACA,EAEA,wBAAAK,EAAA,CACAA,EAAA,SAUAA,EAAA,SAAA,IATAA,EAAA,QAAA,GACAA,EAAA,SAAA,GACA,KAAA,kBAAAA,CAAA,EACA,KAAAT,GAAA,CACAA,EAAA,KAAA,6BAAAA,CAAA,EACAS,EAAA,SAAAT,EACAS,EAAA,QAAA,EACA,CAAA,EAIA,EAEA,sBAAAR,EAAA,CACAA,EAAA,OAAA,UACA,KAAA,iBAAAA,CAAA,EAEA,KAAA,eAAA,CACA,GAAAA,EAAA,GACA,WAAAA,EAAA,UAAA,OAAA,YAAA,EACA,SAAAA,EAAA,QAAA,OAAA,YAAA,CACA,CAAA,CAEA,CACA,EAEA,OAAA,CACA,EAEA,MAAA,CACA,EAEA,UAAA,CACA,MAAA,CACA,MAAA,GAAA,KAAA,GAAA,qBAAA,WACA,CACA,CACA"}