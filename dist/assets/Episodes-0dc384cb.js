import{q as h,L as m,f,p as g,N as y,B as r,j as C,k as _,O as v,R as k,Q as E,U as S,V as D,a as M,W as T,X as $,m as c,b as p,n as u,_ as w,Y as b,Z as x,$ as L,a0 as A,a1 as F,a2 as P,t as U,a3 as V,D as H,a4 as B,w as I,a5 as N,a6 as q,a7 as K,x as Q,l as z,G as O,o as Y,e as R,A as W}from"./index-d0b155bb.js";import{E as G}from"./EditEpisodeModal-f758b043.js";const X={name:"episode-list",mixins:[h,m,f,g,y],props:{displayedEpisodes:{type:Array,default:()=>[]},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},validationColumns:{type:Array,default:()=>[]},departmentFilter:{type:Array,default:()=>[]}},data(){return{type:"episode",hiddenColumns:{},lastHeaderMenuDisplayed:null,lastMetadaDataHeaderMenuDisplayed:null,lastHeaderMenuDisplayedIndexInGrid:null,lastSelectedEpisode:null,lastSelection:null,metadataDisplayHeaders:{estimation:!0,timeSpent:!0,status:!0},offsets:{},stickedColumns:{},episodeStatusOptions:[{label:"canceled",value:"canceled"},{label:"complete",value:"complete"},{label:"running",value:"running"},{label:"standby",value:"standby"}]}},components:{ButtonSimple:r,DescriptionCell:C,EntityThumbnail:_,MetadataHeader:v,RowActionsCell:k,TableHeaderMenu:E,TableMetadataHeaderMenu:S,TableMetadataSelectorMenu:D,TableInfo:M,ValidationCell:T,ValidationHeader:$},computed:{...c(["currentProduction","episodeMap","episodeFilledColumns","episodeMetadataDescriptors","episodes","episodeSearchText","episodeSelectionGrid","currentEpisode","displayedEpisodesEstimation","displayedEpisodesLength","displayedEpisodesTimeSpent","isBigThumbnails","isCurrentUserAdmin","isCurrentUserManager","isCurrentUserSupervisor","isCurrentUserClient","isSingleEpisode","isEpisodeDescription","isEpisodeEstimation","isEpisodeTime","isShowAssignations","isShowInfos","nbSelectedTasks","taskMap","taskTypeMap","user"]),isEmptyList(){return this.displayedEpisodes.length&&this.displayedEpisodes[0].length===0&&!this.isLoading&&!this.isError&&(!this.episodeSearchText||this.episodeSearchText.length===0)},isListVisible(){return!this.isLoading&&!this.isError&&this.displayedEpisodesLength>0},visibleColumns(){let i=2;return i+=!this.isCurrentUserClient&&this.isShowInfos&&this.isEpisodeDescription?1:0,i+=this.visibleMetadataDescriptors.length,i+=!this.isCurrentUserClient&&this.isShowInfos&&this.isEpisodeTime&&this.metadataDisplayHeaders.timeSpent?1:0,i+=!this.isCurrentUserClient&&this.isShowInfos&&this.isEpisodeEstimation&&this.metadataDisplayHeaders.estimation?1:0,i+=this.displayedValidationColumns.length,i},displayedValidationColumns(){return this.validationColumns.filter(i=>this.episodeFilledColumns[i]&&(!this.hiddenColumns[i]||this.isShowInfos))},metadataDescriptors(){return this.episodeMetadataDescriptors},localStorageStickKey(){return`stick-episodes-${this.currentProduction.id}`}},methods:{...p(["setEpisodeSelection"]),isSelected(i,e){return this.episodeSelectionGrid[i]&&this.episodeSelectionGrid[i][e]},episodePath(i){return this.getPath("episode",i)},getPath(i,e){const t={name:i,params:{production_id:this.currentProduction.id}};return e&&(t.params.episode_id=e),t},onEpisodeStatusChanged(i,e){this.$emit("field-changed",{entry:i,fieldName:"status",value:e})}},watch:{displayedEpisodes(){this.$options.lineIndex={}},validationColumns(){this.initHiddenColumns(this.validationColumns,this.hiddenColumns)},stickedColumns(){this.updateOffsets()},isLoading(){this.updateOffsets()}}};var Z=function(){var e=this,t=e._self._c;return t("div",{staticClass:"data-list"},[t("div",{directives:[{name:"scroll",rawName:"v-scroll",value:e.onBodyScroll,expression:"onBodyScroll"}],ref:"body",staticClass:"datatable-wrapper"},[t("table-header-menu",{ref:"headerMenu",attrs:{"is-minimized":e.hiddenColumns[e.lastHeaderMenuDisplayed],"is-edit-allowed":e.isCurrentUserManager,"is-sticked":e.stickedColumns[e.lastHeaderMenuDisplayed]},on:{"minimize-clicked":function(s){return e.onMinimizeColumnToggled()},"delete-all-clicked":function(s){return e.onDeleteAllTasksClicked()},"sort-by-clicked":function(s){return e.onSortByTaskTypeClicked()},"select-column":e.onSelectColumn,"toggle-stick":function(s){return e.stickColumnClicked()}}}),t("table-metadata-header-menu",{ref:"headerMetadataMenu",attrs:{"is-episode-allowed":e.isMetadataColumnEditAllowed(e.lastMetadaDataHeaderMenuDisplayed),"is-sticked":e.stickedColumns[e.lastMetadaDataHeaderMenuDisplayed]},on:{"edit-clicked":function(s){return e.onEpisodeMetadataClicked()},"delete-clicked":function(s){return e.onDeleteMetadataClicked()},"sort-by-clicked":function(s){return e.onSortByMetadataClicked()},"toggle-stick":function(s){return e.metadataStickColumnClicked(s)}}}),t("table",{staticClass:"datatable"},[t("thead",{directives:[{name:"columns-resizable",rawName:"v-columns-resizable"}],staticClass:"datatable-head",attrs:{id:"datatable-episode"}},[t("tr",[t("th",{ref:"th-episode",staticClass:"name episode-name datatable-row-header",attrs:{scope:"col"}},[t("div",{staticClass:"flexrow"},[t("span",{staticClass:"flexrow-item"},[e._v(" "+e._s(e.$t("episodes.fields.name"))+" ")]),(e.isCurrentUserManager||e.isCurrentUserSupervisor)&&!e.isLoading?t("button-simple",{staticClass:"is-small flexrow-item",attrs:{icon:"plus",text:""},on:{click:e.onAddMetadataClicked}}):e._e()],1)]),e._l(e.stickedVisibleMetadataDescriptors,function(s,l){return e.isShowInfos?t("metadata-header",{key:s.id,ref:`editor-${l}`,refInFor:!0,attrs:{descriptor:s,left:e.offsets["editor-"+l]?`${e.offsets["editor-"+l]}px`:"0","is-stick":""},on:{"show-metadata-header-menu":a=>e.showMetadataHeaderMenu(s.id,a)}}):e._e()}),e._l(e.stickedDisplayedValidationColumns,function(s,l){return e.isLoading?e._e():t("validation-header",{key:s,ref:`validation-${l}`,refInFor:!0,attrs:{"hidden-columns":e.hiddenColumns,"column-id":s,"validation-style":e.getValidationStyle(s),left:e.offsets["validation-"+l]?`${e.offsets["validation-"+l]}px`:"0",type:"editor","is-stick":""},on:{"show-header-menu":a=>e.showHeaderMenu(s,l,a)}})}),!e.isCurrentUserClient&&e.isShowInfos&&e.isEpisodeDescription?t("th",{staticClass:"description selectable",attrs:{scope:"col"}},[e._v(" "+e._s(e.$t("episodes.fields.description"))+" ")]):e._e(),e._l(e.nonStickedVisibleMetadataDescriptors,function(s){return e.isShowInfos?t("metadata-header",{key:s.id,attrs:{descriptor:s},on:{"show-metadata-header-menu":l=>e.showMetadataHeaderMenu(s.id,l)}}):e._e()}),!e.isCurrentUserClient&&e.isShowInfos&&e.isEpisodeTime&&e.metadataDisplayHeaders.timeSpent?t("th",{ref:"th-spent",staticClass:"time-spent",attrs:{scope:"col"}},[e._v(" "+e._s(e.$t("episodes.fields.time_spent"))+" ")]):e._e(),!e.isCurrentUserClient&&e.isShowInfos&&e.isEpisodeEstimation&&e.metadataDisplayHeaders.estimation?t("th",{ref:"th-spent",staticClass:"estimation",attrs:{scope:"col",title:e.$t("main.estimation")}},[e._v(" "+e._s(e.$t("main.estimation_short"))+" ")]):e._e(),e.isShowInfos&&e.metadataDisplayHeaders.status?t("th",{ref:"th-status",staticClass:"status",attrs:{scope:"col"}},[e._v(" "+e._s(e.$t("main.status"))+" ")]):e._e(),e._l(e.nonStickedDisplayedValidationColumns,function(s,l){return e.isLoading?e._e():t("validation-header",{key:s,attrs:{"hidden-columns":e.hiddenColumns,"column-id":s,"validation-style":e.getValidationStyle(s),type:"episodes"},on:{"show-header-menu":a=>{e.showHeaderMenu(s,l,a)}}})}),t("th",{ref:"actionsSection",staticClass:"actions",attrs:{scope:"col"}},[e.isCurrentUserManager&&e.displayedEpisodes.length>0&&!e.isLoading?t("button-simple",{class:{"is-small":!0,highlighted:e.isEmptyTask},attrs:{icon:"plus",text:e.$t("tasks.create_tasks")},on:{click:function(s){return e.$emit("create-tasks")}}}):e._e(),t("table-metadata-selector-menu",{directives:[{name:"show",rawName:"v-show",value:e.columnSelectorDisplayed&&e.isShowInfos,expression:"columnSelectorDisplayed && isShowInfos"}],ref:"headerMetadataSelectorMenu",attrs:{metadataDisplayHeaders:e.metadataDisplayHeaders,descriptors:e.episodeMetadataDescriptors,exclude:{timeSpent:!e.isEpisodeTime,estimation:!e.isEpisodeEstimation},namespace:"episodes"},on:{"update:metadataDisplayHeaders":function(s){e.metadataDisplayHeaders=s},"update:metadata-display-headers":function(s){e.metadataDisplayHeaders=s}}}),e.episodeMetadataDescriptors.length>0&&e.isShowInfos?t("button-simple",{staticClass:"is-small is-pulled-right",attrs:{icon:"down"},on:{click:e.toggleColumnSelector}}):e._e()],1)],2)]),t("tbody",{staticClass:"datatable-body"},e._l(e.displayedEpisodes,function(s,l){return!e.isLoading&&e.isListVisible?t("tr",{key:s.id,staticClass:"datatable-row",class:{canceled:s.canceled},attrs:{scope:"row"}},[t("th",{class:{"datatable-row-header":!0,"episode-name":!0,name:!0,strong:!s.canceled}},[t("div",{staticClass:"flexrow"},[t("entity-thumbnail",{attrs:{entity:s,width:e.isBigThumbnails?150:50,height:e.isBigThumbnails?100:33,"empty-width":e.isBigThumbnails?150:50,"empty-height":e.isBigThumbnails?100:34}}),t("router-link",{attrs:{tabindex:"-1",title:s.name,to:e.episodePath(s.id)}},[e._v(" "+e._s(s.name)+" ")])],1)]),e._l(e.stickedVisibleMetadataDescriptors,function(a,n){return e.isShowInfos?t("td",{key:s.id+"-"+a.id,ref:`editor-${l}-${n}`,refInFor:!0,staticClass:"metadata-descriptor datatable-row-header",style:{left:e.offsets["editor-"+n]?`${e.offsets["editor-"+n]}px`:"0"},attrs:{title:s.data?s.data[a.field_name]:""}},[a.choices.length===0&&(e.isCurrentUserManager||e.isSupervisorInDepartments(a.departments))?t("input",{staticClass:"input-editor",domProps:{value:e.getMetadataFieldValue(a,s)},on:{input:d=>e.onMetadataFieldChanged(s,a,d),keyup:function(d){return d.ctrlKey?(o=>e.onInputKeyUp(o,l,n)).apply(null,arguments):null}}}):e.isCurrentUserManager||e.isSupervisorInDepartments(a.departments)?t("span",{staticClass:"select"},[t("select",{staticClass:"select-input",on:{keyup:function(d){return d.ctrlKey?(o=>e.onInputKeyUp(o,l,n)).apply(null,arguments):null},change:d=>e.onMetadataFieldChanged(s,a,d)}},e._l(e.getDescriptorChoicesOptions(a),function(d,o){return t("option",{key:`${s.id}-${a.id}-${o}-${d.label}-${d.value}`,domProps:{value:d.value,selected:e.getMetadataFieldValue(a,s)===d.value}},[e._v(" "+e._s(d.label)+" ")])}),0)]):t("span",{staticClass:"metadata-value selectable"},[e._v(" "+e._s(e.getMetadataFieldValue(a,s))+" ")])]):e._e()}),e._l(e.stickedDisplayedValidationColumns,function(a,n){return e.isLoading?e._e():t("validation-cell",{key:a+"-"+s.id,ref:`validation-${l}-${n}`,refInFor:!0,class:{"validation-cell":!e.hiddenColumns[a],"hidden-validation-cell":e.hiddenColumns[a],"datatable-row-header":!0},attrs:{column:e.taskTypeMap.get(a),columnY:n,entity:s,"is-assignees":e.isShowAssignations,"is-static":!0,left:e.offsets["validation-"+n]?`${e.offsets["validation-"+n]}px`:"0",minimized:e.hiddenColumns[a],rowX:l,selected:e.isSelected(l,n),sticked:!0,"task-test":e.taskMap.get(s.validations.get(a))},on:{select:d=>e.onTaskSelected(d,!0),unselect:d=>e.onTaskUnselected(d,!0)}})}),!e.isCurrentUserClient&&e.isShowInfos&&e.isEpisodeDescription?t("description-cell",{staticClass:"description",attrs:{entry:s,editable:e.isCurrentUserManager},on:{"description-changed":a=>e.onDescriptionChanged(s,a)}}):e._e(),e._l(e.nonStickedVisibleMetadataDescriptors,function(a,n){return e.isShowInfos?t("td",{key:s.id+"-"+a.id,staticClass:"metadata-descriptor",attrs:{title:s.data?s.data[a.field_name]:""}},[a.choices.length===0&&(e.isCurrentUserManager||e.isSupervisorInDepartments(a.departments))?t("input",{staticClass:"input-editor",domProps:{value:e.getMetadataFieldValue(a,s)},on:{input:d=>e.onMetadataFieldChanged(s,a,d),keyup:function(d){return d.ctrlKey?(o=>e.onInputKeyUp(o,l,n)).apply(null,arguments):null}}}):e.isCurrentUserManager||e.isSupervisorInDepartments(a.departments)?t("span",{staticClass:"select"},[t("select",{staticClass:"select-input",on:{keyup:function(d){return d.ctrlKey?(o=>e.onInputKeyUp(o,l,n)).apply(null,arguments):null},change:d=>e.onMetadataFieldChanged(s,a,d)}},e._l(e.getDescriptorChoicesOptions(a),function(d,o){return t("option",{key:`${s.id}-${a.id}-${o}-${d.label}-${d.value}`,domProps:{value:d.value,selected:e.getMetadataFieldValue(a,s)===d.value}},[e._v(" "+e._s(d.label)+" ")])}),0)]):t("span",{staticClass:"metadata-value selectable"},[e._v(" "+e._s(e.getMetadataFieldValue(a,s))+" ")])]):e._e()}),!e.isCurrentUserClient&&e.isShowInfos&&e.isEpisodeTime&&e.metadataDisplayHeaders.timeSpent?t("td",{staticClass:"time-spent selectable"},[e._v(" "+e._s(e.formatDuration(s.timeSpent))+" ")]):e._e(),!e.isCurrentUserClient&&e.isShowInfos&&e.isEpisodeEstimation&&e.metadataDisplayHeaders.estimation?t("td",{staticClass:"estimation selectable"},[e._v(" "+e._s(e.formatDuration(s.estimation))+" ")]):e._e(),e.isShowInfos&&e.metadataDisplayHeaders.status?t("td",{ref:"th-status",refInFor:!0,staticClass:"status metadata-descriptor",attrs:{scope:"col"}},[t("span",{staticClass:"select"},[t("select",{staticClass:"select-input",on:{change:a=>e.onEpisodeStatusChanged(s,a.target.value)}},e._l(e.episodeStatusOptions,function(a){return t("option",{key:`${s.id}-status-option-${a.value}`,domProps:{value:a.value,selected:(s.status||"running")===a.value}},[e._v(" "+e._s(e.$t("episodes.status."+a.label))+" ")])}),0)])]):e._e(),e._l(e.nonStickedDisplayedValidationColumns,function(a,n){return e.isLoading?e._e():t("validation-cell",{key:`${a}-${s.id}`,ref:`validation-${l}-${n+e.stickedDisplayedValidationColumns.length}`,refInFor:!0,class:{"validation-cell":!e.hiddenColumns[a],"hidden-validation-cell":e.hiddenColumns[a]},attrs:{column:e.taskTypeMap.get(a),entity:s,"task-test":e.taskMap.get(s.validations?s.validations.get(a):null),minimized:e.hiddenColumns[a],selected:e.isSelected(l,n+e.stickedDisplayedValidationColumns.length),rowX:l,columnY:n,"is-assignees":e.isShowAssignations},on:{select:e.onTaskSelected,unselect:e.onTaskUnselected}})}),e.isCurrentUserManager?t("row-actions-cell",{attrs:{entry:s},on:{"delete-clicked":function(a){return e.$emit("delete-clicked",s)},"edit-clicked":function(a){return e.$emit("edit-clicked",s)}}}):t("td",{staticClass:"actions"})],2):e._e()}),0)])],1),t("table-info",{attrs:{"is-loading":e.isLoading,"is-error":e.isError}}),e.isEmptyList&&e.isCurrentUserClient&&!e.isLoading?t("div",{staticClass:"has-text-centered"},[e._m(0),t("p",{staticClass:"info"},[e._v(e._s(e.$t("episodes.empty_list_client")))])]):e._e(),!e.isEmptyList&&!e.isLoading?t("p",{staticClass:"has-text-centered nb-episodes"},[e._v(" "+e._s(e.displayedEpisodesLength)+" "+e._s(e.$tc("episodes.number",e.displayedEpisodesLength))+" "),e.displayedEpisodesTimeSpent>0&&e.displayedEpisodesEstimation>0?t("span",[e._v(" ("+e._s(e.formatDuration(e.displayedEpisodesTimeSpent))+" "+e._s(e.$tc("main.days_spent",e.displayedEpisodesTimeSpent))+", "+e._s(e.formatDuration(e.displayedEpisodesEstimation))+" "+e._s(e.$tc("main.man_days",e.displayedEpisodesEstimation))+") ")]):e._e()]):e._e()],1)},J=[function(){var i=this,e=i._self._c;return e("p",{staticClass:"info"},[e("img",{attrs:{src:w}})])}],j=u(X,Z,J,!1,null,"f76861fd",null,null);const ee=j.exports;const te={name:"episodes",mixins:[b,x],components:{ActionPanel:L,AddMetadataModal:A,AddThumbnailsModal:F,BigThumbnailsButton:P,BuildFilterModal:U,ButtonSimple:r,CreateTasksModal:V,DeleteModal:H,EditEpisodeModal:G,EpisodeList:ee,HardDeleteModal:B,SearchField:I,SearchQueryList:N,SortingInfo:q,ShowAssignationsButton:K,ShowInfosButton:Q,TaskInfo:z},data(){return{type:"episode",deleteAllTasksLockText:null,descriptorToEdit:{},departmentFilter:[],episodeToDelete:null,episodeToEdit:null,formData:null,genericColumns:["metadata_column_name => text value","task_type_name => task_status_name","task_type_name comment => comment text"],historyEdit:{},initialLoading:!0,isSearchActive:!1,optionalColumns:["Description"],pageName:"Episodes",parsedCSV:[],selectedDepartment:"ALL",taskTypeForTaskDeletion:null,modals:{isAddMetadataDisplayed:!1,isAddThumbnailsDisplayed:!1,isBuildFilterDisplayed:!1,isCreateTasksDisplayed:!1,isDeleteDisplayed:!1,isDeleteMetadataDisplayed:!1,isDeleteAllTasksDisplayed:!1,isImportRenderDisplayed:!1,isImportDisplayed:!1,isNewDisplayed:!1},loading:{addMetadata:!1,addThumbnails:!1,creatingTasks:!1,creatingTasksStay:!1,deleteAllTasks:!1,deleteMetadata:!1,episode:!1,del:!1,importing:!1,stay:!1},errors:{addMetadata:!1,deleteMetadata:!1,creatingTasks:!1,deleteAllTasks:!1,importing:!1,importingError:null}}},beforeDestroy(){this.clearSelectedEpisodes()},created(){this.setLastProductionScreen("episodes")},mounted(){let i="";this.episodeSearchText&&this.episodeSearchText.length>0&&this.searchField.setValue(this.episodeSearchText),this.$route.query.search&&this.$route.query.search.length>0&&(i=""+this.$route.query.search),i==="undefined"&&(i=""),this.$refs["episode-list"].setScrollPosition(this.episodeListScrollPosition),this.onSearchChange(),this.$refs["episode-list"].setScrollPosition(this.episodeListScrollPosition),!this.isCurrentUserManager&&this.user.departments.length>0?(this.selectedDepartment="MY_DEPARTMENTS",this.departmentFilter=this.user.departments):this.departmentFilter=[];const e=()=>{this.initialLoading=!1,this.$refs["episode-list"]&&(this.$refs["episode-search-field"].setValue(i),this.onSearchChange(),this.$refs["episode-list"].setScrollPosition(this.episodeListScrollPosition))};this.episodeMap.size<1||this.episodeValidationColumns.length===0||this.episodeMap.values().next().project_id!==this.currentProduction.id?this.loadEpisodesWithTasks().then(()=>{this.initialLoading=!1}).catch(console.error):(this.isEpisodesLoading||(this.initialLoading=!1),e())},computed:{...c(["currentEpisode","currentProduction","displayedEpisodes","departments","episodeMap","episodes","episodeSearchQueries","isCurrentUserClient","isCurrentUserManager","isEpisodeDescription","isEpisodeEstimation","isEpisodeTime","isEpisodesLoading","isEpisodesLoadingError","isShowAssignations","isTVShow","nbSelectedTasks","openProductions","selectedTasks","episodeMap","episodeFilledColumns","episodesCsvFormData","episodeSearchText","episodeValidationColumns","episodeListScrollPosition","episodeSorting","taskTypeMap","user","departmentMap","productionEpisodeTaskTypes"]),renderColumns(){var i=[...this.dataMatchers,...this.optionalColumns];return this.productionEpisodeTaskTypes.forEach(e=>{i.push(e.name),i.push(e.name+" comment")}),i},filteredEpisodes(){const i={};return this.displayedEpisodes.forEach(e=>{const t=e.name;i[t]=!0}),i},metadataDescriptors(){return this.episodeMetadataDescriptors}},methods:{...p(["addMetadataDescriptor","createTasks","changeEpisodeSort","clearSelectedEpisodes","commentTaskWithPreview","deleteAllTasks","deleteEpisode","deleteMetadataDescriptor","editEpisode","getEpisodesCsvLines","hideAssignations","loadEpisodesWithTasks","newEpisode","removeEpisodeSearch","saveEpisodeSearch","setLastProductionScreen","setPreview","setEpisodeSearch","showAssignations","uploadEpisodeFile"]),confirmAddMetadata(i){this.loading.addMetadata=!0,i.entity_type="Episode",this.addMetadataDescriptor(i).then(()=>{this.loading.addMetadata=!1,this.modals.isAddMetadataDisplayed=!1}).catch(e=>{console.error(e),this.loading.addMetadata=!1,this.errors.addMetadata=!0})},showNewModal(){this.episodeToEdit={},this.modals.isNewDisplayed=!0},confirmDeleteEpisode(){this.loading.del=!0,this.errors.del=!1,this.deleteEpisode(this.episodeToDelete).then(()=>{this.loading.del=!1,this.modals.isDeleteDisplayed=!1}).catch(i=>{console.error(i),this.loading.del=!1,this.errors.del=!0})},runTasksCreation(i,e){return this.errors.creatingTasks=!1,this.createTasks({type:"episodes",task_type_id:i.task_type_id,project_id:this.currentProduction.id,selectionOnly:e})},reset(){this.initialLoading=!1,this.loadEpisodesWithTasks(i=>{i&&console.error(i),this.initialLoading=!1})},resetEditModal(){const i={name:""};this.openProductions.length>0&&(i.production_id=this.openProductions[0].id),this.episodeToEdit=i},applySearch(i){this.setEpisodeSearch(i),this.setSearchInUrl(),this.isSearchActive=!0},saveSearchQuery(i){this.saveEpisodeSearch(i).catch(console.error)},removeSearchQuery(i){this.removeEpisodeSearch(i).catch(console.error)},onExportClick(){this.getEpisodesCsvLines().then(i=>{const e=[O().format("YYYY-MM-DD"),"kitsu",this.currentProduction.name,this.$t("episodes.title")],t=Y.slugify(e.join("_")),s=[this.$t("episodes.fields.name"),this.$t("episodes.fields.description")];this.currentEpisode&&s.splice(0,0,"Episode"),R([...this.currentProduction.descriptors]).filter(l=>l.entity_type==="Episode").forEach(l=>{s.push(l.name)}),this.isEpisodeTime&&s.push(this.$t("episodes.fields.time_spent")),this.isEpisodeEstimation&&s.push(this.$t("main.estimation_short")),this.episodeValidationColumns.forEach(l=>{s.push(this.taskTypeMap.get(l).name),s.push("Assignations")}),W.buildCsvFile(t,[s].concat(i))})},onFieldChanged({entry:i,fieldName:e,value:t}){const s={id:i.id,description:i.description};s[e]=t,this.editEpisode(s)},onMetadataChanged({entry:i,descriptor:e,value:t}){const s={};s[e.field_name]=t;const l={id:i.id,data:s};this.editEpisode(l)},onEditClicked(i){this.episodeToEdit=i,this.modals.isNewDisplayed=!0},onDeleteClicked(i){this.episodeToDelete=i,this.modals.isDeleteDisplayed=!0},confirmEditEpisode(i){this.loading.edit=!0,this.errors.edit=!1,i.id?this.editEpisode(i).then(()=>{this.loading.edit=!1,this.modals.isNewDisplayed=!1}).catch(()=>{this.loading.edit=!1,this.errors.edit=!0}):(i.project_id=this.currentProduction.id,this.newEpisode(i).then(()=>{this.loading.edit=!1,this.modals.isNewDisplayed=!1}).catch(()=>{this.loading.edit=!1,this.errors.edit=!0}))},deleteText(){const i=this.episodeToDelete;return i?this.$t("episodes.delete_text",{name:i.name}):""}},watch:{$route(){if(!this.$route.query)return;const i=this.$route.query.search,e=this.$refs["episode-search-field"].getValue();i!==e&&(this.searchField.setValue(i),this.applySearch(i))},currentProduction(){this.$refs["episode-search-field"].setValue(""),this.$store.commit("SET_EDIT_LIST_SCROLL_POSITION",0),this.initialLoading=!1,this.reset()},isEpisodesLoading(){if(!this.isEpisodesLoading){let i="";this.$route.query.search&&this.$route.query.search.length>0&&(i=""+this.$route.query.search),this.initialLoading=!1,this.$refs["episode-search-field"].setValue(i),this.$nextTick(()=>{this.applySearch(i)}),this.$refs["episode-list"]&&this.$refs["episode-list"].setScrollPosition(this.episodeListScrollPosition)}}},metaInfo(){return{title:`${this.currentProduction.name} ${this.$t("episodes.title")} - Kitsu`}}};var se=function(){var e=this,t=e._self._c;return t("div",{staticClass:"columns fixed-page"},[t("action-panel"),t("div",{staticClass:"column main-column"},[t("div",{staticClass:"episodes page"},[t("div",{staticClass:"episode-list-header page-header"},[t("div",{staticClass:"flexrow"},[t("search-field",{ref:"episode-search-field",attrs:{"can-save":!0,active:e.isSearchActive,placeholder:"ex: e01 episode=wip"},on:{change:e.onSearchChange,enter:e.saveSearchQuery,save:e.saveSearchQuery}}),t("button-simple",{staticClass:"flexrow-item",attrs:{title:e.$t("entities.build_filter.title"),icon:"funnel"},on:{click:()=>e.modals.isBuildFilterDisplayed=!0}}),t("div",{staticClass:"filler"}),e.isCurrentUserClient?e._e():t("div",{staticClass:"flexrow flexrow-item"},[t("show-assignations-button",{staticClass:"flexrow-item"}),t("show-infos-button",{staticClass:"flexrow-item"}),t("big-thumbnails-button",{staticClass:"flexrow-item"})],1),e.isCurrentUserManager?t("div",{staticClass:"flexrow"},[t("button-simple",{staticClass:"flexrow-item",attrs:{text:e.$t("episodes.new_episode"),icon:"plus"},on:{click:e.showNewModal}})],1):e._e()],1),t("div",{staticClass:"query-list mt1"},[!e.isEpisodesLoading&&!e.initialLoading?t("search-query-list",{attrs:{queries:e.episodeSearchQueries},on:{"change-search":e.changeSearch,"remove-search":e.removeSearchQuery}}):e._e()],1)]),e.episodeSorting&&e.episodeSorting.length>0?t("sorting-info",{attrs:{label:e.$t("main.sorted_by"),sorting:e.episodeSorting},on:{"clear-sorting":function(s){return e.onChangeSortClicked(null)}}}):e._e(),t("episode-list",{ref:"episode-list",attrs:{"displayed-episodes":e.displayedEpisodes,"is-loading":e.isEpisodesLoading||e.initialLoading,"is-error":e.isEpisodesLoadingError,"validation-columns":e.episodeValidationColumns,"department-filter":e.departmentFilter},on:{"add-metadata":e.onAddMetadataClicked,"change-sort":e.onChangeSortClicked,"create-tasks":e.showCreateTasksModal,"delete-all-tasks":e.onDeleteAllTasksClicked,"delete-clicked":e.onDeleteClicked,"delete-metadata":e.onDeleteMetadataClicked,"edit-clicked":e.onEditClicked,"edit-metadata":e.onEditMetadataClicked,"field-changed":e.onFieldChanged,"metadata-changed":e.onMetadataChanged,scroll:e.saveScrollPosition}})],1)]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.nbSelectedTasks===1,expression:"nbSelectedTasks === 1"}],staticClass:"column side-column",attrs:{id:"side-column"}},[t("task-info",{attrs:{task:e.selectedTasks.values().next().value}})],1),t("edit-episode-modal",{attrs:{active:e.modals.isNewDisplayed,"is-loading":e.loading.episode,"is-error":e.errors.episode,"episode-to-episode":e.episodeToEdit},on:{cancel:function(s){e.modals.isNewDisplayed=!1},confirm:e.confirmEditEpisode}}),t("delete-modal",{ref:"delete-episode-modal",attrs:{active:e.modals.isDeleteDisplayed,"is-loading":e.loading.del,"is-error":e.errors.del,text:e.deleteText(),"error-text":e.$t("episodes.delete_error")},on:{cancel:function(s){e.modals.isDeleteDisplayed=!1},confirm:e.confirmDeleteEpisode}}),t("delete-modal",{ref:"delete-metadata-modal",attrs:{active:e.modals.isDeleteMetadataDisplayed,"is-loading":e.loading.deleteMetadata,"is-error":e.errors.deleteMetadata,text:e.$t("productions.metadata.delete_text"),"error-text":e.$t("productions.metadata.delete_error")},on:{cancel:function(s){e.modals.isDeleteMetadataDisplayed=!1},confirm:e.confirmDeleteMetadata}}),t("hard-delete-modal",{ref:"delete-all-tasks-modal",attrs:{active:e.modals.isDeleteAllTasksDisplayed,"is-loading":e.loading.deleteAllTasks,"is-error":e.errors.deleteAllTasks,text:e.deleteAllTasksText(),"error-text":e.$t("tasks.delete_all_error"),"lock-text":e.deleteAllTasksLockText,"selection-option":!0},on:{cancel:function(s){e.modals.isDeleteAllTasksDisplayed=!1},confirm:e.confirmDeleteAllTasks}}),t("create-tasks-modal",{attrs:{active:e.modals.isCreateTasksDisplayed,"is-loading":e.loading.creatingTasks,"is-loading-stay":e.loading.creatingTasksStay,"is-error":e.errors.creatingTasks,title:e.$t("tasks.create_tasks_episode"),text:e.$t("tasks.create_tasks_episode_explaination"),"error-text":e.$t("tasks.create_tasks_episode_failed")},on:{cancel:e.hideCreateTasksModal,confirm:e.confirmCreateTasks,"confirm-and-stay":e.confirmCreateTasksAndStay}}),t("add-metadata-modal",{attrs:{active:e.modals.isAddMetadataDisplayed,"is-loading":e.loading.addMetadata,"is-loading-stay":e.loading.addMetadata,"is-error":e.errors.addMetadata,"descriptor-to-edit":e.descriptorToEdit,"entity-type":"Episode"},on:{cancel:e.closeMetadataModal,confirm:e.confirmAddMetadata}}),t("add-thumbnails-modal",{ref:"add-thumbnails-modal",attrs:{parent:"episodes",active:e.modals.isAddThumbnailsDisplayed,"is-loading":e.loading.addThumbnails,"is-error":e.errors.addThumbnails},on:{cancel:e.hideAddThumbnailsModal,confirm:e.confirmAddThumbnails}}),t("build-filter-modal",{ref:"build-filter-modal",attrs:{active:e.modals.isBuildFilterDisplayed,"entity-type":"episode"},on:{cancel:function(s){e.modals.isBuildFilterDisplayed=!1},confirm:e.confirmBuildFilter}}),t("edit-episode-modal",{attrs:{active:e.modals.isNewDisplayed,"is-loading":e.loading.edit,"is-error":e.errors.edit,"episode-to-edit":e.episodeToEdit},on:{cancel:function(s){e.modals.isNewDisplayed=!1},confirm:e.confirmEditEpisode}}),t("hard-delete-modal",{attrs:{active:e.modals.isDeleteDisplayed,"is-loading":e.loading.del,"is-error":e.errors.del,text:e.deleteText(),"error-text":e.$t("episodes.delete_error"),"lock-text":e.episodeToDelete?e.episodeToDelete.name:""},on:{cancel:function(s){e.modals.isDeleteDisplayed=!1},confirm:e.confirmDeleteEpisode}})],1)},ie=[],ae=u(te,se,ie,!1,null,"220b6aa7",null,null);const ne=ae.exports;export{ne as default};
//# sourceMappingURL=Episodes-0dc384cb.js.map
